# Основы баз данных

## Мотивация

Любой современный сервер имеет дело с базами данных. От простейшего сервиса записи в парикмахерскую по телефону, до ВКонтакте и Яндекса.

## Реляционная модель данных

Формальная модель баз данных, основанная на теории множеств и логике.

* Данные в базе данных представляют собой набор отношений (*структурный* аспект)
* Отношения отвечают условиям целостности (аспект *целостности*)
* Реляционная модель данных поддерживает операторы манипулирования отношениями (аспект *обработки*)

В РМД включается теория нормализации - способа приведения данных БД к нормальной форме.

Нормальная форма — свойство отношения в реляционной модели данных, характеризующее его с точки зрения избыточности, потенциально приводящей к логически ошибочным результатам выборки или изменения данных. Нормальная форма определяется как совокупность требований, которым должно удовлетворять отношение.

О нормализации дальше.

Пара фактов, упрощающих понимание:

* модель является логической, то есть отношения являются логическими (абстрактными), а не физическими (хранимыми) структурами;
* для реляционных баз данных верен информационный принцип: всё информационное наполнение базы данных представлено одним и только одним способом, а именно — явным заданием значений атрибутов в кортежах отношений.

У РМД есть конкретная реализация - в виде таблиц баз данных. Об этом дальше.

## Нормализация

### Первая нормальная форма

Переменная отношения находится в первой нормальной форме тогда и только тогда, когда в любом допустимом значении отношения каждый его кортеж содержит только одно значение для каждого из атрибутов.

В реляционной модели отношение всегда находится в первой нормальной форме по определению понятия отношение.

Таблицы могут не быть правильными представлениями отношений и не находиться в 1НФ.

Рассматриваемая таблица должна удовлетворять следующим пяти условиям, чтобы быть в 1НФ:

* Порядок строк не несет в себе никакой информации.
* Порядок столбцов не несет в себе никакой информации.
* Нет повторяющихся строк.
* Каждое пересечение строки и столбца содержит ровно одно значение соответствующего типа данных (и больше ничего).
* Все столбцы являются обычными.

"Обычность" означает, что вся информация, которую несёт столбец, хранится в его значении - нет скрытой информации, которая доступна при доступе к таблице с помощью специальных операторов.

#### Пример

Исходная ненормализованная (то есть не являющаяся правильным представлением некоторого отношения) таблица:

|Сотрудник|Номер телефона|
|---------|--------------|
|Иванов И.И.|283-56-82|
||390-57-34|
|Петров П.П.|708-62-34|

Таблица, приведённая к 1НФ, являющаяся правильным представлением некоторого отношения:

|Сотрудник|Номер телефона|
|---------|--------------|
|Иванов И.И.|283-56-82|
|Иванов И.И.|390-57-34|
|Петров П.П.|708-62-34|

### Вторая нормальная форма

Переменная отношения находится во второй нормальной форме тогда и только тогда, когда она находится в первой нормальной форме и каждый неключевой атрибут неприводимо зависит от её потенциального ключа.

Неприводимость означает, что в составе потенциального ключа отсутствует меньшее подмножество атрибутов, от которого можно также вывести данную функциональную зависимость.

#### Потенциальный ключ

Потенциальный ключ — минимальное уникальное подмножество атрибутов отношения.

* Уникальность означает, что нет и не может быть двух кортежей данного отношения, в которых значения этого подмножества атрибутов совпадают.
  Свойство уникальности определяется не для конкретного значения переменной отношения в тот или иной момент времени, а по всем возможным значениям. Оно следует из внешнего знания о природе и закономерностях данных, которые могут находиться в переменной отношения.
* Минимальность означает, что в составе потенциального ключа отсутствует меньшее подмножество атрибутов, удовлетворяющее условию уникальности. Если из потенциального ключа убрать любой атрибут, он утратит свойство уникальности.

#### Пример 1

Пусть в следующем отношении первичный ключ образует пара атрибутов {Филиал компании, Должность}:

##### R

|Филиал компании|Должность|Зарплата|Наличие компьютера|
|-|-|-|-|
|Филиал в Томске|Уборщик|20000|Нет|
|Филиал в Москве|Программист|40000|Есть|
|Филиал в Томске|Программист|25000|Есть|

Допустим, что зарплата зависит от филиала и должности, а наличие компьютера зависит только от должности.

Существует функциональная зависимость Должность → Наличие компьютера, в которой левая часть является лишь частью первичного ключа, что нарушает условие второй нормальной формы.

Для приведения к 2НФ исходное отношение следует декомпозировать на два отношения:

##### R1

|Филиал компании|Должность|Зарплата|
|-|-|-|-|
|Филиал в Томске|Уборщик|20000|
|Филиал в Москве|Программист|40000|
|Филиал в Томске|Программист|25000|

##### R2

|Должность|Наличие компьютера|
|-|-|
|Уборщик|Нет|
|Программист|Есть|

#### Пример 2

#### R

|Название|Год выпуска|Режиссёр|Актёр|
|-|-|-|-|
|Охотники за приведениями|2016|Пол Фиг|Кристен Уиг|
|Охотники за приведениями|2016|Пол Фиг|Лесли Джонс|
|Охотники за приведениями|2016|Пол Фиг|Кейт МакКиннон|
|Охотники за приведениями|2016|Пол Фиг|Сесили Стронг|
|Охотники за приведениями|1984|Айвен Райтман|Билл Мюррей|
|Охотники за приведениями|1984|Айвен Райтман|Эрни Хадсон|
|Охотники за приведениями|1984|Айвен Райтман|Рик Моранис|

#### R1

|Название|Год выпуска|Режиссёр|
|Охотники за приведениями|2016|Пол Фиг|
|Охотники за приведениями|1984|Айвен Райтман|

#### R2

|Охотники за приведениями|2016|Кристен Уиг|
|Охотники за приведениями|2016|Лесли Джонс|
|Охотники за приведениями|2016|Кейт МакКиннон|
|Охотники за приведениями|2016|Сесили Стронг|
|Охотники за приведениями|1984|Билл Мюррей|
|Охотники за приведениями|1984|Эрни Хадсон|
|Охотники за приведениями|1984|Рик Моранис|

## Домашнее задание

* Практика
  * Выбрать предметную область
  * Выбрать 5 атрибутов
  * Составить пример таблицы из 15 строк (на бумаге)
  * Привести составленную таблицу к 1НФ (в результате может получиться больше 1 таблицы!)
  * Затем привести результат к 2НФ (здесь тоже)
  * Поставить http://sqlitebrowser.org 
* Теория
  * Повторить 3 аспекта РМД
